/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JDialog.java to edit this template
 */
package poly.ui;

import poly.controller.OrderController;
import poly.entity.Order;
import poly.entity.OrderDetail;
import poly.entity.User;
import poly.dao.impl.OrderDAOImpl;
import poly.dao.impl.UserDAOImpl;
import poly.dao.impl.ProductDAOImpl;
import poly.util.XDialog;
import poly.util.XDate;
import javax.swing.table.DefaultTableModel;
import java.util.List;
import poly.controller.OrderController_Nghia;

/**
 *
 * @author Nghia
 */
public class TDDonHangJDialog_nghia extends javax.swing.JDialog implements OrderController_Nghia {

    /**
     * Creates new form TDDonHangJDialog
     */
    public TDDonHangJDialog_nghia(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        // Tự động load dữ liệu khi khởi tạo
        open();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel1 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tblLichSu = new javax.swing.JTable();
        btnYeuCauDoiTraLichSu = new javax.swing.JButton();
        btnXemChiTietLichSu = new javax.swing.JButton();
        cboTrangThai = new javax.swing.JComboBox();
        btnTimTrangThai = new javax.swing.JButton();
        cboThoiGian = new javax.swing.JComboBox();
        btnTimTheoThoiGian = new javax.swing.JButton();
        txtTimKiemLichSu = new javax.swing.JTextField();
        btnTimKiemLichSu = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        tblHienTai = new javax.swing.JTable();
        btnYeuCauDoiTraHienTai = new javax.swing.JButton();
        btnXemChiTietDonHienTai = new javax.swing.JButton();
        btnHuy = new javax.swing.JButton();
        cboThoiGian1 = new javax.swing.JComboBox();
        btnTimTheoThoiGian1 = new javax.swing.JButton();
        cboTrangThai1 = new javax.swing.JComboBox();
        btnTimTrangThai1 = new javax.swing.JButton();
        txtTimKiemHienTai = new javax.swing.JTextField();
        btnTimKiemHienTai = new javax.swing.JButton();
        jLabel3 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        jLabel1.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel1.setText("THEO DÕI ĐƠN HÀNG");

        tblLichSu.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Mã Đơn", "Ngày", "Ngưởi Đặt", "Trạng Thái"
            }
        ));
        tblLichSu.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblLichSuMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tblLichSu);

        btnYeuCauDoiTraLichSu.setText("Yêu Cầu Đổi Trả");
        btnYeuCauDoiTraLichSu.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnYeuCauDoiTraLichSuActionPerformed(evt);
            }
        });

        btnXemChiTietLichSu.setText("Xem Chi Tiết");
        btnXemChiTietLichSu.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnXemChiTietLichSuActionPerformed(evt);
            }
        });

        cboTrangThai.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Tất cả trạng thái", "Pending", "Processing", "Shipped", "Completed", "Cancelled", "Return Requested" }));
        cboTrangThai.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cboTrangThaiActionPerformed(evt);
            }
        });

        btnTimTrangThai.setText("Tìm kiếm");
        btnTimTrangThai.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTimTrangThaiActionPerformed(evt);
            }
        });

        cboThoiGian.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Tất cả thởi gian", "Hôm nay", "Tuần này", "Tháng này", "3 tháng gần đây" }));
        cboThoiGian.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cboThoiGianActionPerformed(evt);
            }
        });

        btnTimTheoThoiGian.setText("Lọc theo thởi gian");
        btnTimTheoThoiGian.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTimTheoThoiGianActionPerformed(evt);
            }
        });

        txtTimKiemLichSu.setToolTipText("Nhập tên khách hàng, số điện thoại, email hoặc mã đơn hàng");
        txtTimKiemLichSu.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtTimKiemLichSuActionPerformed(evt);
            }
        });

        btnTimKiemLichSu.setText("Tìm kiếm");
        btnTimKiemLichSu.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTimKiemLichSuActionPerformed(evt);
            }
        });

        jLabel2.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel2.setText("Tìm kiếm:");

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(91, 91, 91)
                .addComponent(btnYeuCauDoiTraLichSu)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btnXemChiTietLichSu)
                .addGap(162, 162, 162))
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(20, 20, 20)
                .addComponent(jLabel2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtTimKiemLichSu, javax.swing.GroupLayout.PREFERRED_SIZE, 150, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnTimKiemLichSu)
                .addGap(20, 20, 20)
                .addComponent(cboThoiGian, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnTimTheoThoiGian)
                .addGap(20, 20, 20)
                .addComponent(cboTrangThai, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnTimTrangThai)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane1)
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(17, 17, 17)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(txtTimKiemLichSu, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnTimKiemLichSu)
                    .addComponent(cboTrangThai, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnTimTrangThai)
                    .addComponent(cboThoiGian, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnTimTheoThoiGian))
                .addGap(27, 27, Short.MAX_VALUE)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 219, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnYeuCauDoiTraLichSu)
                    .addComponent(btnXemChiTietLichSu))
                .addContainerGap())
        );

        jTabbedPane1.addTab("Lịch Sử Đơn Hàng", jPanel1);

        tblHienTai.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null},
                {null, null, null, null, null},
                {null, null, null, null, null},
                {null, null, null, null, null}
            },
            new String [] {
                "Mã Đơn", "Mã Sản Phẩm", "Ngày Đặt", "Ngưởi Nhận", "Trạng Thái"
            }
        ));
        tblHienTai.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblHienTaiMouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(tblHienTai);

        btnYeuCauDoiTraHienTai.setText("Yêu Cầu Đổi Trả");
        btnYeuCauDoiTraHienTai.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnYeuCauDoiTraHienTaiActionPerformed(evt);
            }
        });

        btnXemChiTietDonHienTai.setText("Xem Chi Tiết");
        btnXemChiTietDonHienTai.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnXemChiTietDonHienTaiActionPerformed(evt);
            }
        });

        btnHuy.setText("Huỷ Đơn Hàng");
        btnHuy.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnHuyActionPerformed(evt);
            }
        });

        cboThoiGian1.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Tất cả thởi gian", "Hôm nay", "Tuần này", "Tháng này", "3 tháng gần đây" }));
        cboThoiGian1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cboThoiGian1ActionPerformed(evt);
            }
        });

        btnTimTheoThoiGian1.setText("Lọc theo thởi gian");
        btnTimTheoThoiGian1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTimTheoThoiGian1ActionPerformed(evt);
            }
        });

        cboTrangThai1.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Tất cả trạng thái", "Pending", "Processing", "Shipped", "Completed", "Cancelled" }));
        cboTrangThai1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cboTrangThai1ActionPerformed(evt);
            }
        });

        btnTimTrangThai1.setText("Tìm kiếm");
        btnTimTrangThai1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTimTrangThai1ActionPerformed(evt);
            }
        });

        txtTimKiemHienTai.setToolTipText("Nhập tên khách hàng, số điện thoại, email hoặc mã đơn hàng");
        txtTimKiemHienTai.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtTimKiemHienTaiActionPerformed(evt);
            }
        });

        btnTimKiemHienTai.setText("Tìm kiếm");
        btnTimKiemHienTai.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTimKiemHienTaiActionPerformed(evt);
            }
        });

        jLabel3.setText("Tìm kiếm:");

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addContainerGap(41, Short.MAX_VALUE)
                .addComponent(jLabel3)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtTimKiemHienTai, javax.swing.GroupLayout.PREFERRED_SIZE, 150, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnTimKiemHienTai)
                .addGap(20, 20, 20)
                .addComponent(cboThoiGian1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnTimTheoThoiGian1)
                .addGap(20, 20, 20)
                .addComponent(cboTrangThai1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnTimTrangThai1)
                .addGap(22, 22, 22))
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGap(96, 96, 96)
                .addComponent(btnYeuCauDoiTraHienTai)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btnHuy)
                .addGap(151, 151, 151)
                .addComponent(btnXemChiTietDonHienTai)
                .addGap(102, 102, 102))
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane2)
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGap(12, 12, 12)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(txtTimKiemHienTai, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnTimKiemHienTai)
                    .addComponent(cboTrangThai1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnTimTrangThai1)
                    .addComponent(cboThoiGian1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnTimTheoThoiGian1))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 225, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(32, 32, 32)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnYeuCauDoiTraHienTai)
                    .addComponent(btnHuy)
                    .addComponent(btnXemChiTietDonHienTai))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jTabbedPane1.addTab("Đơn Hàng Hiện Tại", jPanel2);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jTabbedPane1))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jTabbedPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 368, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(24, 24, 24))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnYeuCauDoiTraLichSuActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnYeuCauDoiTraLichSuActionPerformed
        requestReturn();
    }//GEN-LAST:event_btnYeuCauDoiTraLichSuActionPerformed

    private void btnXemChiTietLichSuActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnXemChiTietLichSuActionPerformed
        viewOrderDetails();
    }//GEN-LAST:event_btnXemChiTietLichSuActionPerformed

    private void tblLichSuMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblLichSuMouseClicked
        edit();
    }//GEN-LAST:event_tblLichSuMouseClicked

    private void tblHienTaiMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblHienTaiMouseClicked
        edit();
    }//GEN-LAST:event_tblHienTaiMouseClicked

    private void formWindowOpened(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened
        open();
    }//GEN-LAST:event_formWindowOpened

    private void btnYeuCauDoiTraHienTaiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnYeuCauDoiTraHienTaiActionPerformed
        requestReturn();
    }//GEN-LAST:event_btnYeuCauDoiTraHienTaiActionPerformed

    private void btnHuyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnHuyActionPerformed
        cancelOrder();
    }//GEN-LAST:event_btnHuyActionPerformed

    private void btnXemChiTietDonHienTaiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnXemChiTietDonHienTaiActionPerformed
        viewOrderDetails();
    }//GEN-LAST:event_btnXemChiTietDonHienTaiActionPerformed

    private void btnTimTrangThaiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTimTrangThaiActionPerformed
        searchByStatus();
    }//GEN-LAST:event_btnTimTrangThaiActionPerformed

    private void btnTimTheoThoiGianActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTimTheoThoiGianActionPerformed
        searchByTime();
    }//GEN-LAST:event_btnTimTheoThoiGianActionPerformed

    private void btnTimKiemLichSuActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTimKiemLichSuActionPerformed
        searchOrders();
    }//GEN-LAST:event_btnTimKiemLichSuActionPerformed

    private void btnTimTheoThoiGian1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTimTheoThoiGian1ActionPerformed
        searchByTime();
    }//GEN-LAST:event_btnTimTheoThoiGian1ActionPerformed

    private void btnTimTrangThai1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTimTrangThai1ActionPerformed
        searchByStatus();
    }//GEN-LAST:event_btnTimTrangThai1ActionPerformed

    private void btnTimKiemHienTaiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTimKiemHienTaiActionPerformed
        searchOrders();
    }//GEN-LAST:event_btnTimKiemHienTaiActionPerformed

    private void txtTimKiemLichSuActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtTimKiemLichSuActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtTimKiemLichSuActionPerformed

    private void cboThoiGianActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cboThoiGianActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cboThoiGianActionPerformed

    private void cboTrangThaiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cboTrangThaiActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cboTrangThaiActionPerformed

    private void txtTimKiemHienTaiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtTimKiemHienTaiActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtTimKiemHienTaiActionPerformed

    private void cboThoiGian1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cboThoiGian1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cboThoiGian1ActionPerformed

    private void cboTrangThai1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cboTrangThai1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cboTrangThai1ActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnHuy;
    private javax.swing.JButton btnTimKiemHienTai;
    private javax.swing.JButton btnTimKiemLichSu;
    private javax.swing.JButton btnTimTheoThoiGian;
    private javax.swing.JButton btnTimTheoThoiGian1;
    private javax.swing.JButton btnTimTrangThai;
    private javax.swing.JButton btnTimTrangThai1;
    private javax.swing.JButton btnXemChiTietDonHienTai;
    private javax.swing.JButton btnXemChiTietLichSu;
    private javax.swing.JButton btnYeuCauDoiTraHienTai;
    private javax.swing.JButton btnYeuCauDoiTraLichSu;
    private javax.swing.JComboBox cboThoiGian;
    private javax.swing.JComboBox cboThoiGian1;
    private javax.swing.JComboBox cboTrangThai;
    private javax.swing.JComboBox cboTrangThai1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JTable tblHienTai;
    private javax.swing.JTable tblLichSu;
    private javax.swing.JTextField txtTimKiemHienTai;
    private javax.swing.JTextField txtTimKiemLichSu;
    // End of variables declaration//GEN-END:variables

    // ========== IMPLEMENTATION ==========
    private OrderDAOImpl orderDAO = new OrderDAOImpl();
    private UserDAOImpl userDAO = new UserDAOImpl();
    private ProductDAOImpl productDAO = new ProductDAOImpl();
    private Order currentOrder = null;

    @Override
    public void open() {
        fillToTable();
        setLocationRelativeTo(null);
    }

    @Override
    public void setForm(Order entity) {
        // Không cần form cho màn hình theo dõi
    }

    @Override
    public Order getForm() {
        return currentOrder;
    }

    @Override
    public void fillToTable() {
        DefaultTableModel model = (DefaultTableModel) tblLichSu.getModel();
        model.setRowCount(0);
        
        try {
            List<Order> list = orderDAO.selectAll();
            for (Order order : list) {
                User user = userDAO.selectById(order.getUserId());
                String customerName = user != null ? user.getFullName() : "N/A";
                
                model.addRow(new Object[]{
                    order.getOrderId(),
                    order.getOrderDate() != null ? order.getOrderDate().toString() : "N/A",
                    customerName,
                    order.getOrderStatus()
                });
            }
        } catch (Exception e) {
            XDialog.alert("Lỗi tải dữ liệu: " + e.getMessage());
        }
        
        fillCurrentOrdersTable();
    }

    private void fillCurrentOrdersTable() {
        DefaultTableModel model = (DefaultTableModel) tblHienTai.getModel();
        model.setRowCount(0);
        
        try {
            // Lấy đơn hàng chưa hoàn thành
            List<Order> list = orderDAO.selectByStatus("Pending");
            list.addAll(orderDAO.selectByStatus("Processing"));
            list.addAll(orderDAO.selectByStatus("Shipped"));
            
            for (Order order : list) {
                User user = userDAO.selectById(order.getUserId());
                String customerName = user != null ? user.getFullName() : "N/A";
                
                model.addRow(new Object[]{
                    order.getOrderId(),
                    getProductNames(order.getOrderId()),
                    order.getOrderDate() != null ? order.getOrderDate().toString() : "N/A",
                    customerName,
                    order.getOrderStatus()
                });
            }
        } catch (Exception e) {
            XDialog.alert("Lỗi tải dữ liệu: " + e.getMessage());
        }
    }

    private String getProductNames(Integer orderId) {
        try {
            List<OrderDetail> details = orderDAO.getOrderDetails(orderId);
            if (details.isEmpty()) return "N/A";
            
            StringBuilder sb = new StringBuilder();
            for (int i = 0; i < Math.min(details.size(), 2); i++) {
                OrderDetail detail = details.get(i);
                if (i > 0) sb.append(", ");
                sb.append(detail.getProductId());
            }
            if (details.size() > 2) sb.append("...");
            return sb.toString();
        } catch (Exception e) {
            return "N/A";
        }
    }

    @Override
    public void edit() {
        int selectedTab = jTabbedPane1.getSelectedIndex();
        int row = selectedTab == 0 ? tblLichSu.getSelectedRow() : tblHienTai.getSelectedRow();
        
        if (row >= 0) {
            Integer orderId = (Integer) (selectedTab == 0 ? 
                tblLichSu.getValueAt(row, 0) : tblHienTai.getValueAt(row, 0));
            currentOrder = orderDAO.selectById(orderId);
        }
    }

    @Override
    public void create() {
        // Không cần tạo mới trong màn hình theo dõi
    }

    @Override
    public void update() {
        // Không cần cập nhật trong màn hình theo dõi
    }

    @Override
    public void delete() {
        // Không cần xóa trong màn hình theo dõi
    }

    @Override
    public void clear() {
        // Không cần clear trong màn hình theo dõi
    }

    @Override
    public void setEditable(boolean editable) {
        // Không cần set editable trong màn hình theo dõi
    }

    @Override
    public void checkAll() {
        // Không cần check all trong màn hình theo dõi
    }

    @Override
    public void uncheckAll() {
        // Không cần uncheck all trong màn hình theo dõi
    }

    @Override
    public void deleteCheckedItems() {
        // Không cần delete checked items trong màn hình theo dõi
    }

    @Override
    public void moveFirst() {
        // Không cần move first trong màn hình theo dõi
    }

    @Override
    public void movePrevious() {
        // Không cần move previous trong màn hình theo dõi
    }

    @Override
    public void moveNext() {
        // Không cần move next trong màn hình theo dõi
    }

    @Override
    public void moveLast() {
        // Không cần move last trong màn hình theo dõi
    }

    @Override
    public void moveTo(int rowIndex) {
        // Không cần move to trong màn hình theo dõi
    }

    // ========== BUSINESS LOGIC ==========
    private void searchOrders() {
        int selectedTab = jTabbedPane1.getSelectedIndex();
        String keyword = selectedTab == 0 ? 
            txtTimKiemLichSu.getText() : txtTimKiemHienTai.getText();
        
        if (keyword.trim().isEmpty()) {
            fillToTable();
            return;
        }
        
        DefaultTableModel model = (DefaultTableModel) (selectedTab == 0 ? 
            tblLichSu.getModel() : tblHienTai.getModel());
        model.setRowCount(0);
        
        try {
            List<Order> allOrders = orderDAO.selectAll();
            List<Order> filteredOrders = new java.util.ArrayList<>();
            
            for (Order order : allOrders) {
                User user = userDAO.selectById(order.getUserId());
                if (user == null) continue;
                
                // Tìm kiếm theo nhiều tiêu chí
                boolean matches = false;
                String searchLower = keyword.toLowerCase().trim();
                
                // Tìm theo mã đơn hàng
                if (order.getOrderId().toString().contains(searchLower)) {
                    matches = true;
                }
                // Tìm theo tên khách hàng
                else if (user.getFullName() != null && 
                         user.getFullName().toLowerCase().contains(searchLower)) {
                    matches = true;
                }
                // Tìm theo số điện thoại
                else if (user.getPhone() != null && 
                         user.getPhone().toLowerCase().contains(searchLower)) {
                    matches = true;
                }
                // Tìm theo email
                else if (user.getEmail() != null && 
                         user.getEmail().toLowerCase().contains(searchLower)) {
                    matches = true;
                }
                
                if (matches) {
                    filteredOrders.add(order);
                }
            }
            
            // Hiển thị kết quả
            for (Order order : filteredOrders) {
                User user = userDAO.selectById(order.getUserId());
                String customerName = user != null ? user.getFullName() : "N/A";
                
                if (selectedTab == 0) {
                    model.addRow(new Object[]{
                        order.getOrderId(),
                        order.getOrderDate() != null ? order.getOrderDate().toString() : "N/A",
                        customerName,
                        order.getOrderStatus()
                    });
                } else {
                    model.addRow(new Object[]{
                        order.getOrderId(),
                        getProductNames(order.getOrderId()),
                        order.getOrderDate() != null ? order.getOrderDate().toString() : "N/A",
                        customerName,
                        order.getOrderStatus()
                    });
                }
            }
            
            if (filteredOrders.isEmpty()) {
                XDialog.alert("Không tìm thấy đơn hàng nào phù hợp với từ khóa: " + keyword);
            }
        } catch (Exception e) {
            XDialog.alert("Lỗi tìm kiếm: " + e.getMessage());
        }
    }

    private void searchByStatus() {
        int selectedTab = jTabbedPane1.getSelectedIndex();
        String status = selectedTab == 0 ? 
            (String) cboTrangThai.getSelectedItem() : (String) cboTrangThai1.getSelectedItem();
            
        if ("Tất cả trạng thái".equals(status)) {
            fillToTable();
            return;
        }
        
        DefaultTableModel model = (DefaultTableModel) (selectedTab == 0 ? 
            tblLichSu.getModel() : tblHienTai.getModel());
        model.setRowCount(0);
        
        try {
            List<Order> list = orderDAO.selectByStatus(status);
            for (Order order : list) {
                User user = userDAO.selectById(order.getUserId());
                String customerName = user != null ? user.getFullName() : "N/A";
                
                if (selectedTab == 0) {
                    model.addRow(new Object[]{
                        order.getOrderId(),
                        order.getOrderDate() != null ? order.getOrderDate().toString() : "N/A",
                        customerName,
                        order.getOrderStatus()
                    });
                } else {
                    model.addRow(new Object[]{
                        order.getOrderId(),
                        getProductNames(order.getOrderId()),
                        order.getOrderDate() != null ? order.getOrderDate().toString() : "N/A",
                        customerName,
                        order.getOrderStatus()
                    });
                }
            }
        } catch (Exception e) {
            XDialog.alert("Lỗi tìm kiếm: " + e.getMessage());
        }
    }

    private void searchByTime() {
        int selectedTab = jTabbedPane1.getSelectedIndex();
        String timeFilter = selectedTab == 0 ? 
            (String) cboThoiGian.getSelectedItem() : (String) cboThoiGian1.getSelectedItem();
            
        if ("Tất cả thời gian".equals(timeFilter)) {
            fillToTable();
            return;
        }
        
        DefaultTableModel model = (DefaultTableModel) (selectedTab == 0 ? 
            tblLichSu.getModel() : tblHienTai.getModel());
        model.setRowCount(0);
        
        try {
            List<Order> list = orderDAO.selectAll(); // Lấy tất cả đơn hàng trước
            List<Order> filteredList = filterOrdersByTime(list, timeFilter);
            
            for (Order order : filteredList) {
                User user = userDAO.selectById(order.getUserId());
                String customerName = user != null ? user.getFullName() : "N/A";
                
                if (selectedTab == 0) {
                    model.addRow(new Object[]{
                        order.getOrderId(),
                        order.getOrderDate() != null ? order.getOrderDate().toString() : "N/A",
                        customerName,
                        order.getOrderStatus()
                    });
                } else {
                    model.addRow(new Object[]{
                        order.getOrderId(),
                        getProductNames(order.getOrderId()),
                        order.getOrderDate() != null ? order.getOrderDate().toString() : "N/A",
                        customerName,
                        order.getOrderStatus()
                    });
                }
            }
        } catch (Exception e) {
            XDialog.alert("Lỗi tìm kiếm: " + e.getMessage());
        }
    }

    private List<Order> filterOrdersByTime(List<Order> orders, String timeFilter) {
        List<Order> filtered = new java.util.ArrayList<>();
        java.time.LocalDate today = java.time.LocalDate.now();
        
        for (Order order : orders) {
            if (order.getOrderDate() == null) continue;
            
            java.time.LocalDate orderDate = order.getOrderDate().toLocalDate();
            boolean include = false;
            
            switch (timeFilter) {
                case "Hôm nay":
                    include = orderDate.equals(today);
                    break;
                case "Tuần này":
                    java.time.LocalDate weekStart = today.minusDays(today.getDayOfWeek().getValue() - 1);
                    include = !orderDate.isBefore(weekStart) && !orderDate.isAfter(today);
                    break;
                case "Tháng này":
                    include = orderDate.getYear() == today.getYear() && 
                             orderDate.getMonth() == today.getMonth();
                    break;
                case "3 tháng gần đây":
                    java.time.LocalDate threeMonthsAgo = today.minusMonths(3);
                    include = !orderDate.isBefore(threeMonthsAgo) && !orderDate.isAfter(today);
                    break;
                default:
                    include = true;
            }
            
            if (include) {
                filtered.add(order);
            }
        }
        
        return filtered;
    }

    private void viewOrderDetails() {
        edit();
        if (currentOrder == null) {
            XDialog.alert("Vui lòng chọn đơn hàng để xem chi tiết!");
            return;
        }
        
        try {
            List<OrderDetail> details = orderDAO.getOrderDetails(currentOrder.getOrderId());
            User user = userDAO.selectById(currentOrder.getUserId());
            
            StringBuilder sb = new StringBuilder();
            sb.append("=== CHI TIẾT ĐƠN HÀNG ===\n");
            sb.append("Mã đơn: ").append(currentOrder.getOrderId()).append("\n");
            sb.append("Ngày đặt: ").append(currentOrder.getOrderDate() != null ? currentOrder.getOrderDate().toString() : "N/A").append("\n");
            sb.append("Khách hàng: ").append(user != null ? user.getFullName() : "N/A").append("\n");
            sb.append("Số điện thoại: ").append(user != null ? user.getPhone() : "N/A").append("\n");
            sb.append("Tổng tiền: ").append(String.format("$%,.2f", currentOrder.getTotalAmount())).append("\n");
            sb.append("Trạng thái: ").append(currentOrder.getOrderStatus()).append("\n");
            sb.append("Phương thức thanh toán: ").append(currentOrder.getPaymentMethod() != null ? currentOrder.getPaymentMethod() : "N/A").append("\n\n");
            
            sb.append("=== DANH SÁCH SẢN PHẨM ===\n");
            for (OrderDetail detail : details) {
                // Lấy thông tin sản phẩm để hiển thị tên thay vì mã
                String productName = "N/A";
                try {
                    poly.entity.Product product = productDAO.selectById(detail.getProductId());
                    if (product != null) {
                        productName = product.getProductName();
                    }
                } catch (Exception e) {
                    // Nếu không lấy được tên sản phẩm thì dùng mã
                    productName = detail.getProductId();
                }
                
                sb.append("• ").append(productName)
                  .append(" - Số lượng: ").append(detail.getQuantity())
                  .append(" - Đơn giá: ").append(String.format("$%,.2f", detail.getUnitPrice()))
                  .append(" - Thành tiền: ").append(String.format("$%,.2f", detail.getUnitPrice().multiply(new java.math.BigDecimal(detail.getQuantity()))))
                  .append("\n");
            }
            
            XDialog.alert(sb.toString());
        } catch (Exception e) {
            XDialog.alert("Lỗi xem chi tiết: " + e.getMessage());
        }
    }

    private void requestReturn() {
        edit();
        if (currentOrder == null) {
            XDialog.alert("Vui lòng chọn đơn hàng để yêu cầu đổi trả!");
            return;
        }
        
        if (!"Completed".equals(currentOrder.getOrderStatus())) {
            XDialog.alert("Chỉ có thể yêu cầu đổi trả đơn hàng đã hoàn thành!");
            return;
        }
        
        if (XDialog.confirm("Bạn có chắc muốn yêu cầu đổi trả đơn hàng này?")) {
            try {
                orderDAO.updateOrderStatus(currentOrder.getOrderId(), "Return Requested");
                XDialog.alert("Đã gửi yêu cầu đổi trả thành công!");
                fillToTable();
            } catch (Exception e) {
                XDialog.alert("Lỗi gửi yêu cầu: " + e.getMessage());
            }
        }
    }

    private void cancelOrder() {
        edit();
        if (currentOrder == null) {
            XDialog.alert("Vui lòng chọn đơn hàng để huỷ!");
            return;
        }
        
        if (!"Pending".equals(currentOrder.getOrderStatus())) {
            XDialog.alert("Chỉ có thể huỷ đơn hàng đang chờ xử lý!");
            return;
        }
        
        if (XDialog.confirm("Bạn có chắc muốn huỷ đơn hàng này?")) {
            try {
                orderDAO.updateOrderStatus(currentOrder.getOrderId(), "Cancelled");
                XDialog.alert("Đã huỷ đơn hàng thành công!");
                fillToTable();
            } catch (Exception e) {
                XDialog.alert("Lỗi huỷ đơn hàng: " + e.getMessage());
            }
        }
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(TDDonHangJDialog_nghia.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(TDDonHangJDialog_nghia.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(TDDonHangJDialog_nghia.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(TDDonHangJDialog_nghia.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>

        /* Create and display the dialog */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                TDDonHangJDialog_nghia dialog = new TDDonHangJDialog_nghia(new javax.swing.JFrame(), true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }
}
