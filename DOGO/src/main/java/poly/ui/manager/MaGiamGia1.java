/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JDialog.java to edit this template
 */
package poly.ui.manager;

import poly.dao.CouponDAO;
import poly.dao.impl.CouponDAOImpl;
import poly.entity.Coupon;
import java.util.List;
import javax.swing.table.DefaultTableModel;
import java.math.BigDecimal;
import java.time.LocalDate;
import javax.swing.JOptionPane;
public class MaGiamGia1 extends javax.swing.JDialog {

   private CouponDAO couponDAO = new CouponDAOImpl();
    private int currentRow = -1;
    private List<Coupon> couponList;
    
    public MaGiamGia1(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
          initComponents();
        setLocationRelativeTo(null);
        fillDiscountTypeComboBox();
        fillToTable();
       
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel1 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        btnSelect = new javax.swing.JButton();
        btnDeleteSelected = new javax.swing.JButton();
        btnRemoveSelected = new javax.swing.JButton();
        txtSearch = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        btnSearch = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        txtId = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        txtDesc = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        txtDiscVaule = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        txtStartDate = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        txtEndDate = new javax.swing.JTextField();
        jComboDisCType = new javax.swing.JComboBox<>();
        btnDellete = new javax.swing.JButton();
        btnRefesh = new javax.swing.JButton();
        btnAdd = new javax.swing.JButton();
        btnUpdate = new javax.swing.JButton();
        jLabel10 = new javax.swing.JLabel();
        jComboDisCType1 = new javax.swing.JComboBox<>();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        jLabel1.setFont(new java.awt.Font("Segoe UI", 1, 24)); // NOI18N
        jLabel1.setText("M√£ Gi·∫£m Gi√°");

        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null, null}
            },
            new String [] {
                "CouponID", "Status", "Description", "DiscountType", "DiscountValue", "StartDate", "EndDate", ""
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Object.class, java.lang.Boolean.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, true
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jTable1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTable1MouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(jTable1);

        btnSelect.setText("Ch·ªçn m·ª•c");
        btnSelect.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSelectActionPerformed(evt);
            }
        });

        btnDeleteSelected.setText("X√≥a m·ª•c ƒë√£ ch·ªçn");
        btnDeleteSelected.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDeleteSelectedActionPerformed(evt);
            }
        });

        btnRemoveSelected.setText("B·ªè ch·ªçn m·ª•c");
        btnRemoveSelected.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRemoveSelectedActionPerformed(evt);
            }
        });

        jLabel8.setText("T√¨m ki·∫øm:");

        btnSearch.setText("T√¨m");
        btnSearch.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSearchActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btnSelect)
                .addGap(36, 36, 36)
                .addComponent(btnDeleteSelected)
                .addGap(27, 27, 27)
                .addComponent(btnRemoveSelected)
                .addGap(29, 29, 29))
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane1)
                .addContainerGap())
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(128, 128, 128)
                .addComponent(jLabel8)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtSearch, javax.swing.GroupLayout.PREFERRED_SIZE, 300, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(btnSearch)
                .addContainerGap(214, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(17, 17, 17)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtSearch, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel8)
                    .addComponent(btnSearch))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 25, Short.MAX_VALUE)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 277, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnSelect)
                    .addComponent(btnDeleteSelected)
                    .addComponent(btnRemoveSelected))
                .addGap(41, 41, 41))
        );

        jTabbedPane1.addTab("Chi ti·∫øt", jPanel1);

        jLabel2.setText("CouponID *");

        jLabel3.setText("Description *");

        jLabel4.setText("DiscountType *");

        jLabel5.setText("DiscountValue *");

        jLabel6.setText("StartDate *");

        jLabel7.setText("EndDate *");

        jComboDisCType.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        btnDellete.setText("X√≥a");
        btnDellete.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDelleteActionPerformed(evt);
            }
        });

        btnRefesh.setText("L√†m m·ªõi");
        btnRefesh.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRefeshActionPerformed(evt);
            }
        });

        btnAdd.setText("Th√™m");
        btnAdd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAddActionPerformed(evt);
            }
        });

        btnUpdate.setText("C·∫≠p nh·∫≠t");
        btnUpdate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnUpdateActionPerformed(evt);
            }
        });

        jLabel10.setText("Status *");

        jComboDisCType1.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Ho·∫°t ƒë·ªông", "Kh√¥ng ho·∫°t ƒë·ªông" }));
        jComboDisCType1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboDisCType1ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(28, 28, 28)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addComponent(jLabel4)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jComboDisCType, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addComponent(jLabel3)
                                .addGap(18, 18, 18)
                                .addComponent(txtDesc))
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addComponent(jLabel2)
                                .addGap(5, 5, 5)
                                .addComponent(txtId, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                                .addComponent(jLabel10)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jComboDisCType1, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addGap(64, 64, 64)
                                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(jPanel2Layout.createSequentialGroup()
                                        .addComponent(jLabel5)
                                        .addGap(18, 18, 18)
                                        .addComponent(txtDiscVaule, javax.swing.GroupLayout.PREFERRED_SIZE, 210, javax.swing.GroupLayout.PREFERRED_SIZE))
                                    .addGroup(jPanel2Layout.createSequentialGroup()
                                        .addComponent(jLabel6)
                                        .addGap(18, 18, 18)
                                        .addComponent(txtStartDate, javax.swing.GroupLayout.PREFERRED_SIZE, 210, javax.swing.GroupLayout.PREFERRED_SIZE))))
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addGap(72, 72, 72)
                                .addComponent(jLabel7)
                                .addGap(18, 18, 18)
                                .addComponent(txtEndDate, javax.swing.GroupLayout.PREFERRED_SIZE, 210, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(167, 167, 167)
                        .addComponent(btnAdd)
                        .addGap(18, 18, 18)
                        .addComponent(btnUpdate)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(btnDellete)
                        .addGap(18, 18, 18)
                        .addComponent(btnRefesh)))
                .addContainerGap(140, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGap(11, 11, 11)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(txtId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel5)
                    .addComponent(txtDiscVaule, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(txtDesc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel6)
                    .addComponent(txtStartDate, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel4)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jComboDisCType, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel7)
                        .addComponent(txtEndDate, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel10)
                    .addComponent(jComboDisCType1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(41, 41, 41)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnAdd)
                    .addComponent(btnUpdate)
                    .addComponent(btnDellete)
                    .addComponent(btnRefesh))
                .addContainerGap(219, Short.MAX_VALUE))
        );

        jTabbedPane1.addTab("Ch·ªânh s·ª≠a", jPanel2);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(301, 301, 301)
                .addComponent(jLabel1)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jTabbedPane1)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel1)
                .addGap(18, 18, 18)
                .addComponent(jTabbedPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 459, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(20, 20, 20))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

        private void jTable1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTable1MouseClicked
        // Ch·ªâ x·ª≠ l√Ω khi double-click (nh·∫•n 2 l·∫ßn)
        if (evt.getClickCount() == 2) {
            int row = jTable1.getSelectedRow();
            if (row >= 0 && row < couponList.size()) {
                String id = (String) jTable1.getValueAt(row, 0);
                Coupon c = couponDAO.selectById(id);
                if (c != null) {
                    setForm(c);
                    currentRow = row;
                    
                    // Chuy·ªÉn sang tab "Ch·ªânh s·ª≠a" ƒë·ªÉ hi·ªÉn th·ªã th√¥ng tin
                    jTabbedPane1.setSelectedIndex(1);
                    
                    // Hi·ªÉn th·ªã th√¥ng b√°o
                    System.out.println("Double-click: ƒê√£ ch·ªçn m√£ gi·∫£m gi√°: " + c.getCouponId() + " - " + c.getDescription());
                    JOptionPane.showMessageDialog(this, 
                        "ƒê√£ ch·ªçn m√£ gi·∫£m gi√°: " + c.getCouponId() + "\nM√¥ t·∫£: " + c.getDescription(), 
                        "Th√¥ng tin m√£ gi·∫£m gi√°", 
                        JOptionPane.INFORMATION_MESSAGE);
                }
            }
        }
    }//GEN-LAST:event_jTable1MouseClicked

    private void btnSelectActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSelectActionPerformed
        selectAllItems();
    }//GEN-LAST:event_btnSelectActionPerformed

    private void btnAddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAddActionPerformed
        try {
            Coupon c = getForm();
            if (couponDAO.selectById(c.getCouponId()) != null) {
                JOptionPane.showMessageDialog(this, 
                    "‚ùå CouponID '" + c.getCouponId() + "' ƒë√£ t·ªìn t·∫°i!\nVui l√≤ng ch·ªçn m√£ kh√°c.", 
                    "L·ªói", 
                    JOptionPane.ERROR_MESSAGE);
                return;
            }
            couponDAO.insert(c);
            fillToTable();
            clearForm();
            JOptionPane.showMessageDialog(this, 
                "‚úÖ Th√™m m√£ gi·∫£m gi√° th√†nh c√¥ng!\n\n" +
                "üé´ M√£: " + c.getCouponId() + "\n" +
                "üìù M√¥ t·∫£: " + c.getDescription() + "\n" +
                "üí∞ Lo·∫°i: " + c.getDiscountType() + "\n" +
                "üí∏ Gi√° tr·ªã: " + c.getDiscountValue(), 
                "Th√†nh c√¥ng", 
                JOptionPane.INFORMATION_MESSAGE);
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(this, 
                "‚ùå L·ªói th√™m m√£ gi·∫£m gi√°: " + ex.getMessage(), 
                "L·ªói", 
                JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_btnAddActionPerformed

    private void btnUpdateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnUpdateActionPerformed
        try {
            Coupon c = getForm();
            if (couponDAO.selectById(c.getCouponId()) == null) {
                JOptionPane.showMessageDialog(this, 
                    "‚ùå CouponID '" + c.getCouponId() + "' kh√¥ng t·ªìn t·∫°i!\nVui l√≤ng ki·ªÉm tra l·∫°i.", 
                    "L·ªói", 
                    JOptionPane.ERROR_MESSAGE);
                return;
            }
            couponDAO.update(c);
            fillToTable();
            clearForm();
            // L·∫•y tr·∫°ng th√°i t·ª´ form
            String newStatus = c.getStatus() != null ? c.getStatus() : "Ho·∫°t ƒë·ªông";
            
            JOptionPane.showMessageDialog(this, 
                "‚úÖ C·∫≠p nh·∫≠t m√£ gi·∫£m gi√° th√†nh c√¥ng!\n\n" +
                "üé´ M√£: " + c.getCouponId() + "\n" +
                "üìù M√¥ t·∫£: " + c.getDescription() + "\n" +
                "üí∞ Lo·∫°i: " + c.getDiscountType() + "\n" +
                "üí∏ Gi√° tr·ªã: " + c.getDiscountValue() + "\n" +
                "üìÖ Ng√†y b·∫Øt ƒë·∫ßu: " + c.getStartDate() + "\n" +
                "üìÖ Ng√†y k·∫øt th√∫c: " + c.getEndDate() + "\n" +
                "üìä Tr·∫°ng th√°i: " + newStatus, 
                "Th√†nh c√¥ng", 
                JOptionPane.INFORMATION_MESSAGE);
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(this, 
                "‚ùå L·ªói c·∫≠p nh·∫≠t m√£ gi·∫£m gi√°: " + ex.getMessage(), 
                "L·ªói", 
                JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_btnUpdateActionPerformed

    private void btnDelleteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDelleteActionPerformed
        int row = jTable1.getSelectedRow();
        if (row < 0) {
            JOptionPane.showMessageDialog(this, 
                "‚ùå Vui l√≤ng ch·ªçn d√≤ng ƒë·ªÉ x√≥a!", 
                "Th√¥ng b√°o", 
                JOptionPane.WARNING_MESSAGE);
            return;
        }
        String id = (String) jTable1.getValueAt(row, 0);
        String desc = (String) jTable1.getValueAt(row, 2);
        
        int confirm = JOptionPane.showConfirmDialog(this, 
            "‚ö†Ô∏è X√°c nh·∫≠n x√≥a m√£ gi·∫£m gi√°?\n\n" +
            "üé´ M√£: " + id + "\n" +
            "üìù M√¥ t·∫£: " + desc + "\n\n" +
            "H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!", 
            "X√°c nh·∫≠n x√≥a", 
            JOptionPane.YES_NO_OPTION);
            
        if (confirm == JOptionPane.YES_OPTION) {
            try {
                couponDAO.delete(id);
                fillToTable();
                clearForm();
                JOptionPane.showMessageDialog(this, 
                    "‚úÖ X√≥a m√£ gi·∫£m gi√° th√†nh c√¥ng!\n\n" +
                    "üé´ M√£: " + id + "\n" +
                    "üìù M√¥ t·∫£: " + desc, 
                    "Th√†nh c√¥ng", 
                    JOptionPane.INFORMATION_MESSAGE);
            } catch (Exception ex) {
                JOptionPane.showMessageDialog(this, 
                    "‚ùå L·ªói x√≥a m√£ gi·∫£m gi√°: " + ex.getMessage(), 
                    "L·ªói", 
                    JOptionPane.ERROR_MESSAGE);
            }
        }
    }//GEN-LAST:event_btnDelleteActionPerformed

    private void btnRefeshActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRefeshActionPerformed
       clearForm();
    }//GEN-LAST:event_btnRefeshActionPerformed

    private void btnDeleteSelectedActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDeleteSelectedActionPerformed
        deleteSelectedItems();
    }//GEN-LAST:event_btnDeleteSelectedActionPerformed

    private void btnRemoveSelectedActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRemoveSelectedActionPerformed
       deselectAllItems();
    }//GEN-LAST:event_btnRemoveSelectedActionPerformed

    private void jComboDisCType1ActionPerformed(java.awt.event.ActionEvent evt) {
        String selectedStatus = (String) jComboDisCType1.getSelectedItem();
        System.out.println("üîÑ ƒê√£ ch·ªçn tr·∫°ng th√°i: " + selectedStatus);
    }
    
    private void btnSearchActionPerformed(java.awt.event.ActionEvent evt) {
        String keyword = txtSearch.getText().trim().toLowerCase();
        DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
        model.setRowCount(0);
        
        if (keyword.isEmpty()) {
            // N·∫øu t·ª´ kh√≥a r·ªóng, hi·ªÉn th·ªã t·∫•t c·∫£
            fillToTable();
            return;
        }
        
        int foundCount = 0;
        for (Coupon c : couponDAO.selectAll()) {
            if (c.getCouponId().toLowerCase().contains(keyword) ||
                (c.getDescription() != null && c.getDescription().toLowerCase().contains(keyword))) {
                
                // L·∫•y tr·∫°ng th√°i t·ª´ database
                String status = c.getStatus() != null ? c.getStatus() : "Ho·∫°t ƒë·ªông";
                
                model.addRow(new Object[] {
                    c.getCouponId(),
                    status,
                    c.getDescription(),
                    c.getDiscountType(),
                    c.getDiscountValue(),
                    c.getStartDate(),
                    c.getEndDate(),
                    false
                });
                foundCount++;
            }
        }
        
        // Hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm
        if (foundCount > 0) {
            JOptionPane.showMessageDialog(this, 
                "T√¨m th·∫•y " + foundCount + " k·∫øt qu·∫£ cho t·ª´ kh√≥a: '" + keyword + "'", 
                "K·∫øt qu·∫£ t√¨m ki·∫øm", 
                JOptionPane.INFORMATION_MESSAGE);
        } else {
            JOptionPane.showMessageDialog(this, 
                "Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o cho t·ª´ kh√≥a: '" + keyword + "'", 
                "K·∫øt qu·∫£ t√¨m ki·∫øm", 
                JOptionPane.WARNING_MESSAGE);
        }
    }
    
    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        String keyword = txtSearch.getText().trim().toLowerCase();
        DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
        model.setRowCount(0);
        
        if (keyword.isEmpty()) {
            // N·∫øu t·ª´ kh√≥a r·ªóng, hi·ªÉn th·ªã t·∫•t c·∫£
            fillToTable();
            return;
        }
        
        int foundCount = 0;
        for (Coupon c : couponDAO.selectAll()) {
            if (c.getCouponId().toLowerCase().contains(keyword) ||
                (c.getDescription() != null && c.getDescription().toLowerCase().contains(keyword))) {
                model.addRow(new Object[] {
                    c.getCouponId(),
                    c.getDescription(),
                    c.getDiscountType(),
                    c.getDiscountValue(),
                    c.getStartDate(),
                    c.getEndDate(),
                    false
                });
                foundCount++;
            }
        }
        
        // Hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm
        if (foundCount > 0) {
            JOptionPane.showMessageDialog(this, 
                "T√¨m th·∫•y " + foundCount + " k·∫øt qu·∫£ cho t·ª´ kh√≥a: '" + keyword + "'", 
                "K·∫øt qu·∫£ t√¨m ki·∫øm", 
                JOptionPane.INFORMATION_MESSAGE);
        } else {
            JOptionPane.showMessageDialog(this, 
                "Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o cho t·ª´ kh√≥a: '" + keyword + "'", 
                "K·∫øt qu·∫£ t√¨m ki·∫øm", 
                JOptionPane.WARNING_MESSAGE);
        }
    }//GEN-LAST:event_jButton1ActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(MaGiamGia1.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(MaGiamGia1.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(MaGiamGia1.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(MaGiamGia1.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>

        /* Create and display the dialog */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                MaGiamGia1 dialog = new MaGiamGia1(new javax.swing.JFrame(), true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAdd;
    private javax.swing.JButton btnDeleteSelected;
    private javax.swing.JButton btnDellete;
    private javax.swing.JButton btnRefesh;
    private javax.swing.JButton btnRemoveSelected;
    private javax.swing.JButton btnSearch;
    private javax.swing.JButton btnSelect;
    private javax.swing.JButton btnUpdate;
    private javax.swing.JComboBox<String> jComboDisCType;
    private javax.swing.JComboBox<String> jComboDisCType1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JTable jTable1;
    private javax.swing.JTextField txtDesc;
    private javax.swing.JTextField txtDiscVaule;
    private javax.swing.JTextField txtEndDate;
    private javax.swing.JTextField txtId;
    private javax.swing.JTextField txtSearch;
    private javax.swing.JTextField txtStartDate;
    // End of variables declaration//GEN-END:variables
private void fillDiscountTypeComboBox() {
        jComboDisCType.removeAllItems();
        jComboDisCType.addItem("Percent");
        jComboDisCType.addItem("Fixed");
    }
   private void fillToTable() {
        try {
            couponList = couponDAO.selectAll();
            DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
            model.setRowCount(0);
            
            for (Coupon c : couponList) {
                // L·∫•y tr·∫°ng th√°i t·ª´ database
                String status = c.getStatus() != null ? c.getStatus() : "Ho·∫°t ƒë·ªông";
                
                model.addRow(new Object[] {
                    c.getCouponId(),
                    status,
                    c.getDescription(),
                    c.getDiscountType(),
                    c.getDiscountValue(),
                    c.getStartDate(),
                    c.getEndDate(),
                    false
                });
            }
            currentRow = -1;
            
            // Hi·ªÉn th·ªã th√¥ng tin t·ªïng quan
            System.out.println("‚úÖ ƒê√£ t·∫£i " + couponList.size() + " m√£ gi·∫£m gi√° t·ª´ database");
            
        } catch (Exception e) {
            System.err.println("‚ùå L·ªói khi t·∫£i d·ªØ li·ªáu: " + e.getMessage());
            JOptionPane.showMessageDialog(this, 
                "L·ªói khi t·∫£i d·ªØ li·ªáu t·ª´ database: " + e.getMessage(), 
                "L·ªói", 
                JOptionPane.ERROR_MESSAGE);
        }
    }
    private void clearForm() {
        txtId.setText("");
        txtDesc.setText("");
        jComboDisCType.setSelectedIndex(0);
        txtDiscVaule.setText("");
        txtStartDate.setText("");
        txtEndDate.setText("");
        jComboDisCType1.setSelectedIndex(0);
        currentRow = -1;
        jTable1.clearSelection();
    }
        private Coupon getForm() {
        String id = txtId.getText().trim();
        String desc = txtDesc.getText().trim();
        String type = (String) jComboDisCType.getSelectedItem();
        String valueStr = txtDiscVaule.getText().trim();
        String startStr = txtStartDate.getText().trim();
        String endStr = txtEndDate.getText().trim();
        String status = (String) jComboDisCType1.getSelectedItem();
        
        // Validate d·ªØ li·ªáu
        if (id.isEmpty() || desc.isEmpty() || valueStr.isEmpty() || startStr.isEmpty() || endStr.isEmpty()) {
            throw new IllegalArgumentException("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        }
        
        BigDecimal value = new BigDecimal(valueStr);
        
        // Ki·ªÉm tra gi√° tr·ªã gi·∫£m gi√° theo lo·∫°i
        if ("Percent".equals(type)) {
            // N·∫øu l√† Percent: ki·ªÉm tra t·ª´ 1% ƒë·∫øn 50%
            if (value.compareTo(BigDecimal.ONE) < 0 || value.compareTo(new BigDecimal("50")) > 0) {
                throw new IllegalArgumentException("Gi√° tr·ªã gi·∫£m gi√° Percent ph·∫£i t·ª´ 1% ƒë·∫øn 50%!");
            }
        } else if ("Fixed".equals(type)) {
            // N·∫øu l√† Fixed: ch·ªâ c·∫ßn l·ªõn h∆°n 0
            if (value.compareTo(BigDecimal.ZERO) <= 0) {
                throw new IllegalArgumentException("Gi√° tr·ªã gi·∫£m gi√° Fixed ph·∫£i l·ªõn h∆°n 0!");
            }
        }
        
        LocalDate start = LocalDate.parse(startStr);
        LocalDate end = LocalDate.parse(endStr);
        
        // Ki·ªÉm tra ng√†y
        if (start.isAfter(end)) {
            throw new IllegalArgumentException("Ng√†y b·∫Øt ƒë·∫ßu kh√¥ng ƒë∆∞·ª£c sau ng√†y k·∫øt th√∫c!");
        }
        
        // T·∫°o Coupon v·ªõi Status
        Coupon coupon = new Coupon(id, desc, type, value, start, end);
        coupon.setStatus(status); // Th√™m status v√†o coupon
        
        return coupon;
    }
          private void setForm(Coupon c) {
        txtId.setText(c.getCouponId());
        txtDesc.setText(c.getDescription());
        jComboDisCType.setSelectedItem(c.getDiscountType());
        txtDiscVaule.setText(c.getDiscountValue() != null ? c.getDiscountValue().toString() : "");
        txtStartDate.setText(c.getStartDate() != null ? c.getStartDate().toString() : "");
        txtEndDate.setText(c.getEndDate() != null ? c.getEndDate().toString() : "");
        
        // Set tr·∫°ng th√°i t·ª´ database
        String status = c.getStatus() != null ? c.getStatus() : "Ho·∫°t ƒë·ªông";
        jComboDisCType1.setSelectedItem(status);
        
        // Hi·ªÉn th·ªã th√¥ng tin tr·∫°ng th√°i
        System.out.println("üìä Tr·∫°ng th√°i m√£ " + c.getCouponId() + ": " + status);
        System.out.println("üìÖ Ng√†y b·∫Øt ƒë·∫ßu: " + c.getStartDate());
        System.out.println("üìÖ Ng√†y k·∫øt th√∫c: " + c.getEndDate());
    }
     
        
        /**
         * Ch·ªçn t·∫•t c·∫£ c√°c m·ª•c trong b·∫£ng
         */
        private void selectAllItems() {
            DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
            int rowCount = model.getRowCount();
            
            if (rowCount == 0) {
                JOptionPane.showMessageDialog(this, "B·∫£ng kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ ch·ªçn!");
                return;
            }
            
            // Ch·ªçn t·∫•t c·∫£ c√°c checkbox
            for (int i = 0; i < rowCount; i++) {
                model.setValueAt(true, i, 6); // C·ªôt 6 l√† checkbox
            }
            
            // ƒê·∫øm s·ªë m·ª•c ƒë√£ ch·ªçn
            int selectedCount = countSelectedItems();
            JOptionPane.showMessageDialog(this, 
                "ƒê√£ ch·ªçn " + selectedCount + " m·ª•c!", 
                "Th√¥ng b√°o", 
                JOptionPane.INFORMATION_MESSAGE);
        }
        
        /**
         * B·ªè ch·ªçn t·∫•t c·∫£ c√°c m·ª•c trong b·∫£ng
         */
        private void deselectAllItems() {
            DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
            int rowCount = model.getRowCount();
            
            if (rowCount == 0) {
                JOptionPane.showMessageDialog(this, "B·∫£ng kh√¥ng c√≥ d·ªØ li·ªáu!");
                return;
            }
            
            // B·ªè ch·ªçn t·∫•t c·∫£ c√°c checkbox
            for (int i = 0; i < rowCount; i++) {
                model.setValueAt(false, i, 6); // C·ªôt 6 l√† checkbox
            }
            
            JOptionPane.showMessageDialog(this, 
                "ƒê√£ b·ªè ch·ªçn t·∫•t c·∫£ m·ª•c!", 
                "Th√¥ng b√°o", 
                JOptionPane.INFORMATION_MESSAGE);
        }
        
        /**
         * X√≥a c√°c m·ª•c ƒë√£ ƒë∆∞·ª£c ch·ªçn
         */
        private void deleteSelectedItems() {
            DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
            int rowCount = model.getRowCount();
            
            if (rowCount == 0) {
                JOptionPane.showMessageDialog(this, "B·∫£ng kh√¥ng c√≥ d·ªØ li·ªáu!");
                return;
            }
            
            // ƒê·∫øm s·ªë m·ª•c ƒë√£ ch·ªçn
            int selectedCount = countSelectedItems();
            
            if (selectedCount == 0) {
                JOptionPane.showMessageDialog(this, "Kh√¥ng c√≥ m·ª•c n√†o ƒë∆∞·ª£c ch·ªçn ƒë·ªÉ x√≥a!");
                return;
            }
            
            // X√°c nh·∫≠n x√≥a
            int confirm = JOptionPane.showConfirmDialog(this, 
                "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a " + selectedCount + " m·ª•c ƒë√£ ch·ªçn?", 
                "X√°c nh·∫≠n x√≥a", 
                JOptionPane.YES_NO_OPTION);
                
            if (confirm == JOptionPane.YES_OPTION) {
                try {
                    int deletedCount = 0;
                    
                    // X√≥a t·ª´ cu·ªëi l√™n ƒë·ªÉ tr√°nh l·ªói index
                    for (int i = rowCount - 1; i >= 0; i--) {
                        Boolean isSelected = (Boolean) model.getValueAt(i, 6);
                        if (isSelected != null && isSelected) {
                            String couponId = (String) model.getValueAt(i, 0);
                            try {
                                couponDAO.delete(couponId);
                                deletedCount++;
                            } catch (Exception ex) {
                                System.err.println("L·ªói x√≥a coupon " + couponId + ": " + ex.getMessage());
                            }
                        }
                    }
                    
                    // Refresh b·∫£ng
                    fillToTable();
                    clearForm();
                    
                    JOptionPane.showMessageDialog(this, 
                        "ƒê√£ x√≥a th√†nh c√¥ng " + deletedCount + " m·ª•c!", 
                        "Th√¥ng b√°o", 
                        JOptionPane.INFORMATION_MESSAGE);
                        
                } catch (Exception ex) {
                    JOptionPane.showMessageDialog(this, 
                        "L·ªói khi x√≥a: " + ex.getMessage(), 
                        "L·ªói", 
                        JOptionPane.ERROR_MESSAGE);
                }
            }
        }
        
        /**
         * ƒê·∫øm s·ªë m·ª•c ƒë√£ ƒë∆∞·ª£c ch·ªçn
         */
        private int countSelectedItems() {
            DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
            int rowCount = model.getRowCount();
            int count = 0;
            
            for (int i = 0; i < rowCount; i++) {
                Boolean isSelected = (Boolean) model.getValueAt(i, 6);
                if (isSelected != null && isSelected) {
                    count++;
                }
            }
            
            return count;
        }
        
        /**
         * L·∫•y danh s√°ch c√°c m·ª•c ƒë√£ ƒë∆∞·ª£c ch·ªçn
         */
        private java.util.List<String> getSelectedCouponIds() {
            DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
            int rowCount = model.getRowCount();
            java.util.List<String> selectedIds = new java.util.ArrayList<>();
            
            for (int i = 0; i < rowCount; i++) {
                Boolean isSelected = (Boolean) model.getValueAt(i, 6);
                if (isSelected != null && isSelected) {
                    String couponId = (String) model.getValueAt(i, 0);
                    selectedIds.add(couponId);
                }
            }
            
            return selectedIds;
        }
        

}
